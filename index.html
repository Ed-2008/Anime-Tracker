<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AnimeTracker</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
      /* --- IMPORT FONT --- */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap");

      /* --- GLOBAL RESET --- */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: #f5f6fa;
        color: #222;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 40px 0;
      }

      .container {
        width: 90%;
        max-width: 700px;
      }

      /* --- HEADINGS --- */
      h1,
      h2 {
        font-weight: 600;
      }

      h1 {
        font-size: 2.2rem;
        text-align: center;
        margin-bottom: 40px;
        color: #333;
      }

      /* --- HIDDEN --- */
      .hidden {
        display: none;
      }

      /* --- AUTH FORMS --- */
      .auth-form {
        background: #fff;
        border-radius: 16px;
        padding: 35px 25px;
        margin-bottom: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .auth-form:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.07);
      }

      .auth-form h2 {
        margin-bottom: 25px;
        font-weight: 500;
        text-align: center;
        color: #444;
      }

      .auth-form input,
      .auth-form select {
        width: 100%;
        padding: 14px 16px;
        margin: 12px 0;
        border-radius: 12px;
        border: 1px solid #ddd;
        font-size: 1rem;
        background: #fff;
        transition: all 0.2s ease;
      }

      .auth-form input:focus,
      .auth-form select:focus {
        outline: none;
        border-color: #6a5efb;
        box-shadow: 0 0 6px rgba(106, 94, 251, 0.2);
      }

      .auth-form .btn {
        width: 100%;
        padding: 14px;
        margin-top: 18px;
        border-radius: 12px;
        border: none;
        background: #6a5efb;
        color: #fff;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .auth-form .btn:hover {
        background: #5846d1;
        transform: translateY(-2px);
      }

      .toggle-text {
        text-align: center;
        margin-top: 15px;
        font-size: 0.95rem;
        color: #666;
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .toggle-text:hover {
        color: #6a5efb;
      }

      /* --- DASHBOARD --- */
      #dashboard {
        animation: fadeIn 0.4s ease forwards;
      }
      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: translateY(10px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
      }

      .logout-btn {
        background: #ff4f4f;
        color: #fff;
        border: none;
        padding: 8px 14px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .logout-btn:hover {
        background: #e03f3f;
      }

      /* --- ADD SECTION --- */
      .add-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .add-section span {
        font-size: 0.95rem;
        color: #555;
      }

      .add-btn {
        background: #6a5efb;
        color: #fff;
        border: none;
        padding: 8px 14px;
        border-radius: 12px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .add-btn:hover {
        background: #5846d1;
      }

      /* --- ANIME LIST CARDS --- */
      .anime-list .anime-card {
        background: #fff;
        border-radius: 16px;
        padding: 16px 20px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
      }

      .anime-list .anime-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .anime-info {
        display: flex;
        gap: 16px;
        align-items: center;
      }

      .anime-name {
        font-weight: 500;
        font-size: 1rem;
        color: #333;
      }

      .status-badge {
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.85rem;
        text-transform: capitalize;
        color: #fff;
        background: #6a5efb;
        font-weight: 500;
      }

      .remove-btn,
      .edit-btn {
        background: transparent;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .remove-btn {
        color: #ff4f4f;
      }
      .remove-btn:hover {
        transform: scale(1.1);
        color: #e03f3f;
      }

      .edit-btn {
        color: #6a5efb;
        margin-right: 10px;
      }
      .edit-btn:hover {
        transform: scale(1.1);
        color: #5846d1;
      }

      /* --- MODAL --- */
      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: #fff;
        border-radius: 16px;
        padding: 30px 25px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
      }

      .modal-content h2 {
        margin-bottom: 20px;
        font-weight: 500;
        color: #333;
      }

      .modal-content input,
      .modal-content select {
        width: 100%;
        padding: 12px 14px;
        margin: 10px 0;
        border-radius: 12px;
        border: 1px solid #ddd;
        font-size: 1rem;
      }

      .modal-content input:focus,
      .modal-content select:focus {
        outline: none;
        border-color: #6a5efb;
      }

      .modal-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
      }

      .modal-buttons .btn {
        flex: 1;
        margin: 0 5px;
        padding: 10px 0;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-weight: 500;
      }

      .modal-buttons .cancel-btn {
        background: #ddd;
        color: #333;
      }

      .modal-buttons .cancel-btn:hover {
        background: #ccc;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- AUTH -->
      <div id="auth">
        <h1>AnimeTracker</h1>

        <form id="loginForm" class="auth-form">
          <h2>Login</h2>
          <input type="email" id="loginEmail" placeholder="Email" required />
          <input
            type="password"
            id="loginPassword"
            placeholder="Password"
            required
          />
          <button type="submit" class="btn">Login</button>
        </form>

        <form id="signupForm" class="auth-form hidden">
          <h2>Sign Up</h2>
          <input type="email" id="signupEmail" placeholder="Email" required />
          <input
            type="password"
            id="signupPassword"
            placeholder="Password"
            required
          />
          <button type="submit" class="btn">Sign Up</button>
        </form>

        <p class="toggle-text" id="toggleAuth">Need an account? Sign up</p>
      </div>

      <!-- DASHBOARD -->
      <div id="dashboard" class="hidden">
        <header class="header">
          <h1>My Anime List</h1>
          <button id="logoutBtn" class="logout-btn">Logout</button>
        </header>

        <div class="add-section">
          <span id="animeCount">0 anime in your list</span>
          <button id="addAnimeBtn" class="add-btn">+ Add Anime</button>
        </div>

        <div id="animeList" class="anime-list"></div>
      </div>

      <!-- ADD MODAL -->
      <div id="animeModal" class="modal" style="display: none">
        <div class="modal-content">
          <h2>Add Anime</h2>
          <input type="text" id="animeName" placeholder="Anime Name" />
          <select id="animeStatus">
            <option>Watching</option>
            <option>Completed</option>
            <option>On Hold</option>
            <option>Waiting</option>
          </select>

          <div class="modal-buttons">
            <button id="saveAnimeBtn" class="btn">Save</button>
            <button id="closeModal" class="btn cancel-btn">Cancel</button>
          </div>
        </div>
      </div>

      <!-- EDIT MODAL -->
      <div id="editAnimeModal" class="modal" style="display: none">
        <div class="modal-content">
          <h2>Edit Anime</h2>
          <input type="text" id="editAnimeName" placeholder="Anime Name" />
          <select id="editAnimeStatus">
            <option>Watching</option>
            <option>Completed</option>
            <option>On Hold</option>
            <option>Waiting</option>
          </select>

          <div class="modal-buttons">
            <button id="updateAnimeBtn" class="btn">Update</button>
            <button id="closeEditModal" class="btn cancel-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const SUPABASE_URL = "https://auirvqwthvudklmyaelq.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1aXJ2cXd0aHZ1ZGtsbXlhZWxxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDY0NjMsImV4cCI6MjA3NDk4MjQ2M30.ndtgIW5RfGA7vDimot3oBOlX4wQQhJvPVVwTi-KL-ek";
      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      const authDiv = document.getElementById("auth");
      const dashboardDiv = document.getElementById("dashboard");
      const loginForm = document.getElementById("loginForm");
      const signupForm = document.getElementById("signupForm");
      const toggleAuth = document.getElementById("toggleAuth");
      const animeListContainer = document.getElementById("animeList");
      const animeCount = document.getElementById("animeCount");
      const addAnimeBtn = document.getElementById("addAnimeBtn");
      const modal = document.getElementById("animeModal");

      const editModal = document.getElementById("editAnimeModal");
      const editNameInput = document.getElementById("editAnimeName");
      const editStatusSelect = document.getElementById("editAnimeStatus");
      let currentEditAnime = null;

      let currentUser = null;

      toggleAuth.onclick = () => {
        if (loginForm.classList.contains("hidden")) {
          loginForm.classList.remove("hidden");
          signupForm.classList.add("hidden");
          toggleAuth.textContent = "Need an account? Sign up";
        } else {
          loginForm.classList.add("hidden");
          signupForm.classList.remove("hidden");
          toggleAuth.textContent = "Already have an account? Login";
        }
      };

      (async function init() {
        const {
          data: { user },
        } = await supabase.auth.getUser();
        if (user) showDashboard(user);
      })();

      function showDashboard(user) {
        currentUser = user;
        authDiv.classList.add("hidden");
        dashboardDiv.classList.remove("hidden");
        loadAnime();
      }

      loginForm.onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error) return alert(error.message);
        showDashboard(data.user);
      };

      signupForm.onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;
        const { data, error } = await supabase.auth.signUp({ email, password });
        if (error) return alert(error.message);
        alert("Account created! Please log in.");
        toggleAuth.click();
      };

      document.getElementById("logoutBtn").onclick = async () => {
        await supabase.auth.signOut();
        currentUser = null;
        dashboardDiv.classList.add("hidden");
        authDiv.classList.remove("hidden");
      };

      async function loadAnime() {
        const { data, error } = await supabase
          .from("anime")
          .select("*")
          .eq("user_id", currentUser.id)
          .order("created_at", { ascending: false });

        animeListContainer.innerHTML = "";
        animeCount.textContent = `${data.length} anime${
          data.length !== 1 ? "s" : ""
        } in your list`;

        if (!error) {
          data.forEach((a) => {
            const card = document.createElement("div");
            card.className = "anime-card";

            const info = document.createElement("div");
            info.className = "anime-info";

            const name = document.createElement("span");
            name.className = "anime-name";
            name.textContent = a.name;

            const status = document.createElement("span");
            status.className = "status-badge";
            status.textContent = a.status;

            info.appendChild(name);
            info.appendChild(status);

            // Buttons
            const editBtn = document.createElement("button");
            editBtn.className = "edit-btn";
            editBtn.innerHTML = "✏️";
            editBtn.onclick = () => openEditModal(a);

            const removeBtn = document.createElement("button");
            removeBtn.className = "remove-btn";
            removeBtn.innerHTML = "🗑";
            removeBtn.onclick = async () => {
              await supabase.from("anime").delete().eq("id", a.id);
              loadAnime();
            };

            const btnGroup = document.createElement("div");
            btnGroup.style.display = "flex";
            btnGroup.style.alignItems = "center";
            btnGroup.appendChild(editBtn);
            btnGroup.appendChild(removeBtn);

            card.appendChild(info);
            card.appendChild(btnGroup);
            animeListContainer.appendChild(card);
          });
        }
      }

      function openEditModal(anime) {
        currentEditAnime = anime;
        editNameInput.value = anime.name;
        editStatusSelect.value = anime.status;
        editModal.style.display = "flex";
      }

      document.getElementById("closeEditModal").onclick = () => {
        editModal.style.display = "none";
        currentEditAnime = null;
      };

      document.getElementById("updateAnimeBtn").onclick = async () => {
        const newName = editNameInput.value;
        const newStatus = editStatusSelect.value;
        if (!newName) return alert("Enter anime name");

        await supabase
          .from("anime")
          .update({ name: newName, status: newStatus })
          .eq("id", currentEditAnime.id);

        editModal.style.display = "none";
        currentEditAnime = null;
        loadAnime();
      };

      addAnimeBtn.onclick = () => (modal.style.display = "flex");
      document.getElementById("closeModal").onclick = () =>
        (modal.style.display = "none");
      document.getElementById("saveAnimeBtn").onclick = async () => {
        const name = document.getElementById("animeName").value;
        const status = document.getElementById("animeStatus").value;
        if (!name) return alert("Enter anime name");
        await supabase
          .from("anime")
          .insert([{ user_id: currentUser.id, name, status }]);
        modal.style.display = "none";
        document.getElementById("animeName").value = "";
        loadAnime();
      };
    </script>
  </body>
</html>
